(function(b,c){var d=function(){var s=null;var o="";var x=b("#cptx_check");var w="";var q="";var z="";var v="";var u="";var l=b("#cptx_sync");var G=[];var p="";var F={autoOpen:false,title:"CPROTEXT",classes:{"ui-dialog":"ui-corner-all cptxDialog","ui-dialog-titlebar":"ui-corner-all",},dialogClass:"cptxDialog",resizable:false,modal:true};function r(H,i){var I=H;if(i){H+=':<br/><span class="cptxmsg cptxerror">'+i+"</span>"}p.html(I);p.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])}function y(){var i=b("#submit");if(i.attr("disabled")==="disabled"){i.removeAttr("disabled")}}function f(){p.dialog("close");p.remove();p=""}function m(i,H){b("#cptx_settings").ajaxForm({beforeSerialize:function(J,I){var K={f:"font",};K[cprotext.API.NONCE_VAR]=H;K=b.param(K);I.url=cprotext.API.URL+K;I.type="post";J[0].enctype="multipart/form-data";b(J[0]).find("input,select,button").attr("disabled","disabled");b(J[0].cptx_newfont).removeAttr("disabled")},beforeSend:function(J){var I=b(".progress");I.css("display","inline-block");var K=0;I.children(".bar").width(K);I.children(".percent").html(K+"%");J.setRequestHeader("Authorization","Bearer "+i)},uploadProgress:function(M,L,K,J){var I=b(".progress");var N=J+"%";I.children(".bar").width(N);I.children(".percent").html(N)},success:function(){var I=b(".progress");var J="100%";I.children(".bar").width(J);I.children(".percent").html(J)},complete:function(N){b("#cptx_settings *").removeAttr("disabled");var J=b.parseJSON(N.responseText);if(J.hasOwnProperty("error")){b(".status").html(J.error);return}b(".status").html(cprotext.L10N.fontfile1+' "'+J.data[1]+'" '+cprotext.L10N.fontfile2);b("#cptx_newfont").val("");b("#cptx_font").append('<option value="'+J.data[0]+'">'+J.data[1]+"</option>");var K=b("#cptx_font option");if(b(K[0]).attr("title")){b("#cptx_font").empty()}var L=[];L.push("[");var M,I;for(M=0,I=K.length;M<I;M++){L.push('["'+b(K[M]).val()+'","'+b(K[M]).html()+'"]');L.push(",")}L.pop();L.push("]");b("#cptx_hfontlist").val(L.join(""))}});p.dialog("close");b("#cptx_settings").submit();b("#cptx_settings").ajaxFormUnbind()}function j(H,J){p.html(cprotext.L10N.importSettings);var I={f:"fonts"};I[cprotext.API.NONCE_VAR]=J;I=b.param(I);var i=b.ajax({url:cprotext.API.URL,data:I,dataType:"jsonp",error:function(K,M,L){r(cprotext.L10N.fontlistFail,M+"/"+L)},beforeSend:function(K){K.setRequestHeader("Authorization","Bearer "+H)},success:function(L){if(L.hasOwnProperty("error")){r(cprotext.L10N.fontlistFail,L.error)}else{var P=[];var O=b("#cptx_font").val();P.push("[");b("#cptx_font").empty();for(var M=0,K=L.fontlist.length;M<K;M++){var N="";if(L.fontlist[M][0]===O){N=' selected="selected" '}b("#cptx_font").append('<option value="'+L.fontlist[M][0]+'"'+N+">"+L.fontlist[M][1]+"</option>");P.push('["'+L.fontlist[M][0]+'","'+L.fontlist[M][1]+'"]');P.push(",")}P.pop();P.push("]");b("#cptx_font, #cptx_newfont").removeAttr("disabled");b("#cptx_hfontlist").val(P.join(""));b("#cptx_hsync").val("1");y()}f()}})}function n(H,J,K){b(".ui-dialog-buttonpane").attr("disabled","disabled").css("visibility","hidden");b(".legen p").html(cprotext.L10N.getInit);var I={f:"get",tid:K};I[cprotext.API.NONCE_VAR]=J;I=b.param(I);var i=b.ajax({url:cprotext.API.URL+I,dataType:"jsonp",beforeSend:function(L){L.setRequestHeader("Authorization","Bearer "+H)},error:function(L,N,M){b(".ui-dialog-buttonpane").removeAttr("disabled").css("visibility","visible");r(cprotext.L10N.getFail,N+"<br/>"+cprotext.L10N.cancellation)},success:function(L){b(".ui-dialog-buttonpane").removeAttr("disabled").css("visibility","visible");if(L.hasOwnProperty("error")){r(cprotext.L10N.getFail,L.error+"<br/>"+cprotext.L10N.cancellation)}else{b("#waitforit").removeClass("dary");b("#cptx_contentVer").val(L.version);b("#cptx_contentCSS").val(L.css);b("#cptx_contentHTML").val(L.html);b("#cptx_contentEOTE").val(L.eote);b("#cptx_contentEOTS").val(L.eots);b("#cptx_contentId").val(L.tid);p.html("<p>"+cprotext.L10N.getSuccess1+"</p><p>"+cprotext.L10N.getSuccess2+"</p>");p.dialog("option","buttons",[{text:cprotext.L10N.submitButton,click:function(){f();b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}if(!b("#cptx_statusChange").val()){b("#cptx_statusChange").val(0)}var M=b("#cptx_statusChange").val();M^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(M);b("#publish").click()}}])}}})}function k(H,K,L,I){I=typeof I!=="undefined"?I:"status";var J={f:"status",tid:L,n:I};J[cprotext.API.NONCE_VAR]=K;J=b.param(J);var i=b.ajax({url:cprotext.API.URL+J,dataType:"jsonp",beforeSend:function(M){M.setRequestHeader("Authorization","Bearer "+H)},error:function(M,O,N){r(cprotext.L10N.submitFail,O+"<br/>"+cprotext.L10N.cancellation)},success:function(N){var P;if(N.hasOwnProperty("error")){r(cprotext.L10N.statusFail,N.error+"<br/>"+cprotext.L10N.cancellation);p.html(P);p.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])}else{var M=cprotext.L10N.statusUnknown;if(N.status===""){M=cprotext.L10N.statusDone}else{switch(N.status[0]){case -1:M=cprotext.L10N.failed+" => ";switch(N.status[1][0]){case 0:M+=cprotext.L10N.statusError0;break;case 1:M+=cprotext.L10N.statusError1;break;case 2:M+=cprotext.L10N.statusError2;break;case 3:M+=N.status[1][4]+" "+cprotext.L10N.statusError3;break;case 4:if(N.status[1][5]==="eot"){M+=cprotext.L10N.statusError41+" "+N.status[1][4]}else{M+=cprotext.L10N.statusError42+" "+N.status[1][4]}break;case 5:if(N.status[1][5]==="eot"){M+=cprotext.L10N.statusError51}else{M+=cprotext.L10N.statusError52}break;case 6:M+=cprotext.L10N.statusError6;break;case 7:M+=cprotext.L10N.statusError7;break}break;case -2:var O={opened:"[",closed:"]"};M=cprotext.L10N.processing+"<br/>"+O.opened+" "+cprotext.L10N.step+" ";switch(N.status[1]){case 1:M+="1/3: "+cprotext.L10N.statusProcess1;break;case 2:M+="2/3: "+cprotext.L10N.statusProcess2;break;case 3:M+="3/3: "+cprotext.L10N.statusProcess3;break}M+=" "+O.closed;break;case 0:M=cprotext.L10N.statusWaiting;break;default:M=cprotext.L10N.statusQueueing+": "+N.status[1][4]+" "+cprotext.L10N.statusRemaining;break}}var Q=b(".status");if(!Q.length){P='<p></p><div class="legen dary" id="waitforit"><p class="status">'+cprotext.L10N.processing+"</p></div>";p.html(P);p.dialog("option","buttons",[{text:cprotext.L10N.returnButton,click:function(){f();b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}if(b("#cptx_contentId").val().charAt(0)==="W"){window.location=b("#wp-admin-bar-view-site>a")[0].href}else{var R=b("#cptx_statusChange").val();if(!(R&cprotext.STATUS.PUBLISHED)&&(R&cprotext.STATUS.CHANGED)&&(R&cprotext.STATUS.CPROTEXTED)){b("#save-post").click()}else{b("#publish").click()}}}}]);p.dialog("open")}Q.html(M)}},complete:function(M,N){if(N!="success"){return}if(M.responseJSON.status!==""){setTimeout(function(){k(M.responseJSON.token,M.responseJSON.wpcptx,L)},2000)}else{switch(I){case"status":k(M.responseJSON.token,M.responseJSON.wpcptx,L,"get");break;case"get":if(M.responseJSON.pwyw){p.html("<p>"+cprotext.L10N.pwyw+"</p>");p.dialog("option","buttons",[{text:"ok",click:function(){f();b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#cptx_statusChange").val(0);if(!b("#cptx_contentId").val()||b("#cptx_contentId").val().charAt(0)==="W"){b("#save-post").click()}else{window.location=b("#wp-admin-bar-view-site>a")[0].href}}}])}else{n(M.responseJSON.token,M.responseJSON.wpcptx,L)}break}}}})}function A(I,L,M){M=typeof M!=="undefined"?M:false;var K={n:"status"};K[cprotext.API.NONCE_VAR]=L;var i={};if(!M){K.f="submit"}else{K.f="update";K.tid=b("#cptx_contentId").val()}var J=b("#cptx_statusChange").val();if(!M||(J&cprotext.STATUS.UPDATE_TITLE)){i.ti=b("#title").val()}if(!M||(J&cprotext.STATUS.UPDATE_CONTENT)){i.c=b("#content").html();if(b("#wp-content-wrap").hasClass("tmce-active")){i.c=tinyMCE.activeEditor.getContent()}else{i.c=b("#content").val()}}if(!M||(J&cprotext.STATUS.UPDATE_PLH)){i.plh=b("#cptx_plh").val()}if(!M||(J&cprotext.STATUS.UPDATE_FONT)){K.ft=b("#cptx_font").val()}K=b.param(K);var H=b.ajax({cptxFunc:M?"update":"submit",url:cprotext.API.URL+K,type:"POST",data:i,dataType:"jsonp",beforeSend:function(N){N.setRequestHeader("Authorization","Bearer "+I)},error:function(N,P,O){r(cprotext.L10N[this.cptxFunc+"Fail"],N.responseJSON+"<br/>"+cprotext.L10N.cancellation)},success:function(N){p.dialog("close");if(N.hasOwnProperty("error")){r(cprotext.L10N[this.cptxFunc+"Fail"],N.error+"<br/>"+cprotext.L10N.cancellation);p.dialog("open")}else{b("#cptx_contentId").val(N.tid);var O=b("#cptx_statusChange").val();if(M&&(O&cprotext.STATUS.WPUPDATES)&&!(O&cprotext.STATUS.UPDATE_CONTENT)&&!(O&cprotext.STATUS.UPDATE_FONT)&&!(O&cprotext.STATUS.UPDATE_PLH)){O^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(O);f();b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}k(N.token,N.wpcptx,N.tid)}}})}function t(H,K){var J={f:"credits",};J[cprotext.API.NONCE_VAR]=K;var I=b("#cptx_statusChange").val();if(b("#cptx_contentId").val()===""||(I&cprotext.STATUS.UPDATE_CONTENT)){J.n="submit"}else{J.n="update"}J=b.param(J);var i=b.ajax({url:cprotext.API.URL,data:J,dataType:"jsonp",error:function(L,N,M){r(cprotext.L10N.creditsFail,cprotext.L10N.cancellation)},beforeSend:function(L){L.setRequestHeader("Authorization","Bearer "+H)},success:function(L){p.dialog("close");if(L.hasOwnProperty("error")){r(cprotext.L10N.creditsFail)}else{if(b("#cptx_contentId").val()===""||(b("#cptx_statusChange").val()&cprotext.STATUS.UPDATE_CONTENT)){A(L.token,L.wpcptx)}else{A(L.token,L.wpcptx,true)}}p.dialog("open")}})}function e(J,i){if(b("#cptx_authtok").length&&b("#cptx_authtok").val().length&&(!cprotext.API.TOKEN.length||cprotext.API.TOKEN!==b("#cptx_hauthtok").val())){cprotext.API.TOKEN=b("#cptx_authtok").val()}p.html("");p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.cancelButton,click:function(){s=null;if(i){window.location=b("#wp-admin-bar-view-site>a")[0].href}f()}}]}));p.html('<span class="wait">'+cprotext.L10N.authentication+"</span>");var I={f:"token"};I[cprotext.API.NONCE_VAR]=cprotext.API.INITIAL_NONCE;if(l.length){if(o==="cptx_sync"){I.n="fonts"}else{if(o==="cptx_newfont"){I.n="font"}}}else{if(b("#cptx_contentId").val().charAt(0)==="W"){I.n="status"}else{I.n="credits"}}I=b.param(I);var H=b.ajax({url:cprotext.API.URL,data:I,beforeSend:function(K){if(cprotext.API.TOKEN.length){K.setRequestHeader("Authorization","Bearer "+cprotext.API.TOKEN)}},dataType:"jsonp",error:function(K,M,L){r(cprotext.L10N.identifyFail,M+"/"+L)},success:function(K){if(K.hasOwnProperty("error")){r(cprotext.L10N.identifyFail,K.error)}else{if(l.length){if(o==="cptx_sync"){j(K.token,K.wpcptx)}else{if(o==="cptx_newfont"){m(K.token,K.wpcptx)}}}else{if(b("#cptx_contentId").val().charAt(0)=="W"){k(K.token,K.wpcptx,b("#cptx_contentId").val().substr(1))}else{t(K.token,K.wpcptx)}}}}})}function C(H){var i="";if(H&cprotext.STATUS.UPDATE_CONTENT){i+="<li> - "+cprotext.L10N.commitUpdateContent+"</li>"}if(H&cprotext.STATUS.UPDATE_TITLE){i+="<li> - "+cprotext.L10N.commitUpdateTitle+"</li>"}if(H&cprotext.STATUS.UPDATE_FONT){i+="<li> - "+cprotext.L10N.commitUpdateFont+"</li>"}if(H&cprotext.STATUS.UPDATE_PLH){i+="<li> - "+cprotext.L10N.commitUpdatePlh+"</li>"}if(i!==""){b("#cptx_statusChange").val(H);e("<div>"+cprotext.L10N.authenticationRequired+"</div><ul>"+i+"</ul>")}else{H^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(H);b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}}function h(J){o=J.target.id;if(l.length){p=b('<div id="cptxDialog"></div>');e()}if(x.length&&(x.prop("checked")||x[0].getAttribute("checked"))){var I=cprotext.STATUS.CPROTEXTED|cprotext.STATUS.PROCESSING;if(b('#post_status>option[selected="selected"]').val()!=="publish"){I|=cprotext.STATUS.NOT_PUBLISHED;if(b("#publish").length&&b("#publish").attr("name")==="publish"){I|=cprotext.STATUS.CHANGED}else{I|=cprotext.STATUS.NOT_CHANGED}}else{I|=cprotext.STATUS.PUBLISHED;if(b("#post_status>option:selected").val()==="publish"){I|=cprotext.STATUS.NOT_CHANGED}else{I|=cprotext.STATUS.CHANGED}}var H="";if(b("#wp-content-wrap").hasClass("tmce-active")){H=tinyMCE.activeEditor.getContent()}else{H=b("#content").val()}if(q!=H){I|=cprotext.STATUS.UPDATE_CONTENT}if(w!==b("#title").val()){I|=cprotext.STATUS.UPDATE_TITLE}if(z!==b("#cptx_font").val()){I|=cprotext.STATUS.UPDATE_FONT}if(v!==b("#cptx_plh").val()){I|=cprotext.STATUS.UPDATE_PLH}if(u!==b("#cptx_kw").val()){I|=cprotext.STATUS.UPDATE_KW}if(b("#cptxed").length){cptxed=b("#cptxed").val()}p=b('<div id="cptxDialog"></div>');var i="";switch(I&(cprotext.STATUS.PUBLISHED|cprotext.STATUS.CHANGED)){case (cprotext.STATUS.NOT_PUBLISHED|cprotext.STATUS.NOT_CHANGED):p.html("<div>"+cprotext.L10N.bugReportRequired+"</div>");p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}));break;case (cprotext.STATUS.NOT_PUBLISHED|cprotext.STATUS.CHANGED):if(!cptxed){b("#cptx_statusChange").val(I);e()}else{C(I)}break;case (cprotext.STATUS.PUBLISHED|cprotext.STATUS.NOT_CHANGED):if(x[0].getAttribute("checked")==="checked"){if(x.prop("checked")){C(I)}else{I^=cprotext.STATUS.CPROTEXTED;I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}}else{if(x.prop("checked")){if(!cptxed){b("#cptx_statusChange").val(I);e()}else{C(I)}}else{I^=cprotext.STATUS.CPROTEXTED;I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);p.html("<div>"+cprotext.L10N.bugReportRequired+"</div>");p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}))}}break;case (cprotext.STATUS.PUBLISHED|cprotext.STATUS.CHANGED):if(x[0].getAttribute("checked")==="checked"){if(x.prop("checked")){i="<div>"+cprotext.L10N.unpublished;if(I&cprotext.STATUS.WPUPDATES){i+=cprotext.L10N.detachedFromRevision}else{i+=cprotext.L10N.attachedToRevision}i+="</div>";p.html(i);p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:function(){f();b("#cptx_statusChange").val(I);b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}}]}))}else{I^=cprotext.STATUS.CPROTEXTED;I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}}else{if(x.prop("checked")){i="<div>"+cprotext.L10N.uselessProtection+"</div>";p.html(i);p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:function(){f();I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);b("#publish").off("click.cptx");while(G.length>0){b("#publish").on("click",G.shift())}b("#publish").click()}}]}))}else{I^=cprotext.STATUS.CPROTEXTED;I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);i="<div>"+cprotext.L10N.bugReportRequired+"</div>";p.html(i);p.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}))}}break}}if(p!==""){p.dialog("open");J.stopImmediatePropagation();return false}}function E(i){if(!b("#cptx_authtok").val().length){b("#cptx_sync, #cptx_font, #cptx_newfont").attr("disabled","disabled");b("#cptx_authtok").addClass("redborders")}else{if(b("#cptx_authtok").val()===b("#cptx_hauthtok").val()){b("#cptx_sync, #cptx_font, #cptx_newfont").removeAttr("disabled");b("#cptx_authtok").removeClass("redborders");if(b("#cptx_hsync").val()==="1"){b("#cptx_sync").removeClass("redborders")}}else{b("#cptx_sync").removeAttr("disabled");b("#cptx_font, #cptx_newfont").attr("disabled","disabled");b("#cptx_authtok, #cptx_sync").addClass("redborders");b("#cptx_hsync").val("0")}}if(b("#cptx_hsync").val()==="0"){b("#cptx_font, #cptx_newfont").attr("disabled","disabled");b("#cptx_sync").addClass("redborders")}}if(x.length||l.length){b("#cptx_check").on("click",function(){if(b(this).attr("checked")==="checked"){b("#cptx_font, #cptx_font option").removeAttr("disabled");b("#cptx_kw").removeAttr("disabled");b("#cptx_plh").removeAttr("disabled");b("#cptxed").removeAttr("disabled");b("#cptx_contentVer").removeAttr("disabled");b("#cptx_contentCSS").removeAttr("disabled");b("#cptx_contentHTML").removeAttr("disabled");b("#cptx_contentEOTE").removeAttr("disabled");b("#cptx_contentEOTS").removeAttr("disabled");b("#cptx_contentId").removeAttr("disabled");b("#cptx_statusChange").removeAttr("disabled");z=b("#cptx_font").val();v=b("#cptx_plh").val();u=b("#cptx_kw").val()}else{b("#cptx_font, #cptx_font option").attr("disabled","disabled");b("#cptx_kw").attr("disabled","disabled");b("#cptx_plh").attr("disabled","disabled");b("#cptxed").attr("disabled","disabled");b("#cptx_contentVer").attr("disabled","disabled");b("#cptx_contentCSS").attr("disabled","disabled");b("#cptx_contentHTML").attr("disabled","disabled");b("#cptx_contentEOTE").attr("disabled","disabled");b("#cptx_contentEOTS").attr("disabled","disabled");b("#cptx_contentId").attr("disabled","disabled");b("#cptx_statusChange").attr("disabled","disabled")}});if(x.length&&b("#cptx_contentId").val().charAt(0)==="W"){p=b('<div id="cptxDialog"></div>');e("<p>"+cprotext.L10N.resume+"</p>",true);p.dialog("open")}if(b("#publish").length){var g=b._data(b("#publish")[0],"events");for(var B=0,D=g.click.length;B<D;B++){G.push(g.click[B].handler)}b("#publish").off("click")}else{E();b("#cptx_settings").on("change","input,select,textarea",y)}b("#publish, #cptx_sync").on("click.cptx",h);b("#cptx_newfont").on("change.cptx",h);b("#cptx_authtok").on("input.cptx, propertychange.cptx",E)}if(x.length){w=b("#title").val();if(b("#wp-content-wrap").hasClass("tmce-active")){q=tinyMCE.activeEditor.getContent()}else{q=b("#content").val()}z=b("#cptx_font").val();v=b("#cptx_plh").val();u=b("#cptx_kw").val()}};var a=window.onload;if(typeof window.onload!=="function"){window.onload=d}else{window.onload=function(){if(a){a()}d()}}}(jQuery));